<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Pythonで1次元有限要素解析（Poisson方程式）</title><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name="viewport" /><meta content="#55c500" name="theme-color" /><meta content="XWpkTG32-_C4joZoJ_UsmDUi-zaH-hcrjF6ZC_FoFbk" name="google-site-verification" /><link href="/manifest.json" rel="manifest" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><script async="" src="https://www.googletagmanager.com/gtag/js?id=AW-935296116&amp;l=livesenseDataLayer"></script><script>window.livesenseDataLayer = window.livesenseDataLayer || [];
function livesenseGtag(){livesenseDataLayer.push(arguments);}
livesenseGtag('js', new Date());
livesenseGtag('config', 'AW-935296116');

// Event snippet for qiita remarketing page
livesenseGtag('event', 'conversion', {
    'send_to': 'AW-935296116/jvRhCOaj5YYBEPT4_b0D',
    'value': 1.0,
    'currency': 'JPY',
    'aw_remarketing_only': true
});</script><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="EWdPHklGsDl+maaIaj6jlZPKVoz744TuWWAfw0UTnNf5scTmSRQO98DR8vVPGtsz918kySwBeV27WXoqH/OHjg==" /><link rel="shortcut icon" type="image/x-icon" href="https://cdn.qiita.com/assets/favicons/public/production.ico" /><link rel="apple-touch-icon" type="image/png" href="https://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link rel="stylesheet" media="all" href="https://cdn.qiita.com/assets/public/style-2d80e72c803ca9e45c84122ab1dbb0dd.min.css" /><script src="https://cdn.qiita.com/assets/public/bundle-8ac399f68e55b74bf8c523d5df1d5e90.min.js" defer="defer"></script><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="@Sunset_Yuhi" name="twitter:creator" /><meta property="og:type" content="article"><meta property="og:title" content="Pythonで1次元有限要素解析（Poisson方程式） - Qiita"><meta property="og:image" content="https://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png"><meta property="og:description" content="　Qiita全体で数値計算の話題が少なそうだったので、有限要素法（finite element method, FEM）の記事を書いてみました。書き足りなかったり内容が曖昧な所があります。修正リクエストなど書いていただける方、お待ちし..."><meta content="https://qiita.com/Sunset_Yuhi/items/4c4ddc25609a7619cce0" property="og:url" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /></head><body><div class="allWrapper"><div data-hyperapp-app="GlobalHeader" data-hyperapp-props="{&quot;unreadNotificationsCount&quot;:null,&quot;realms&quot;:[{&quot;humanName&quot;:&quot;Qiita&quot;,&quot;isCurrentRealm&quot;:true,&quot;isQiita&quot;:true,&quot;isQiitaTeam&quot;:false,&quot;loggedInUser&quot;:null,&quot;teamId&quot;:null,&quot;url&quot;:&quot;https://qiita.com/&quot;}],&quot;teamFindUrl&quot;:&quot;https://teams-center.qiita.com/find_team&quot;,&quot;isTeamOnlyUser&quot;:null,&quot;currentUser&quot;:null}"><div class="st-Header" id="globalHeader"><div class="st-Header_container"><div class="st-Header_start"><a class="st-Header_logo mr-1" href="/"><svg viewBox="0 0 75 25" xmlns="http://www.w3.org/2000/svg"><title>Qiita</title><path d="M24.6 12.2C24.6 6.2 20 0 12.2 0 6.2 0 0 4.6 0 12.4c0 6 4.6 12.2 12.4 12.2 2.5 0 5-.8 7.1-2.3l3.6 3.6 1.6-1.6-3.4-3.4c2.1-2.3 3.3-5.3 3.3-8.7zm-12.4-10c5.7 0 10.2 4.4 10.2 10.1 0 4.9-3.8 10.1-10.1 10.1s-10.1-5.1-10.1-10c0-6.4 5.1-10.2 10-10.2zM30.5 7.1h2.1v17h-2.1zM31.5 4.8c-1 0-1.8-.8-1.8-1.8s.8-1.8 1.8-1.8 1.8.8 1.8 1.8-.8 1.8-1.8 1.8zM40 4.8c-1 0-1.8-.8-1.8-1.8S39 1.2 40 1.2s1.8.8 1.8 1.8S41 4.8 40 4.8zM39 7.1h2.1v17H39zM53.7 24.4c-3.9 0-6.2-3-6.2-6v-16h2.1v4.7H57v2.1h-7.4v9.3c0 1.9 1.5 3.9 4.1 3.9.7 0 1.4-.2 2-.6l.2-.1 1 1.8-.2.1c-.9.5-2 .8-3 .8zM67.6 24.5c-5.7 0-9.1-4.5-9.1-8.9 0-5.7 4.5-9.1 8.9-9.1 2.3 0 4.1.8 5.4 2.3V7.1h2.1v17h-2.1v-1.9c-1.2 1.5-3 2.3-5.2 2.3zm-.2-15.9c-3.4 0-6.8 2.6-6.8 7 0 3.4 2.6 6.8 7 6.8 2 0 4-.9 5.3-2.5v-8.8c-1.4-1.6-3.3-2.5-5.5-2.5z"></path></svg></a><div><div class="st-Header_realmSelector"><span class="fa fa-fw fa-caret-down"></span></div></div><div><div class="st-Header_community">コミュニティ<span class="fa fa-fw fa-caret-down ml-1of2"></span></div></div><form class="st-Header_search"><span class="fa fa-search"></span><input class="st-Header_searchInput" placeholder="キーワードを入力" type="search" /></form><div class="st-Header_searchButton"><span class="fa fa-serach"></span></div></div><div class="st-Header_end"><a class="st-Header_signupButton" href="/signup">ユーザ登録</a><a class="st-Header_loginLink" href="/login">ログイン</a></div></div></div></div><script type="application/ld+json">{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"/","name":"Qiita"}},{"@type":"ListItem","position":2,"item":{"@id":"/tags/python","name":"Python"}}]}</script><script async="" src="https://cdn.bigmining.com/private/js/qiita_bigmining.js"></script><div style="display:none"><div class="TagList__label"><span></span><span>Python</span></div><div class="TagList__label"><span></span><span>数値計算</span></div><div class="TagList__label"><span></span><span>scipy</span></div><div class="TagList__label"><span></span><span>有限要素法</span></div><div class="TagList__label"><span></span><span>FEM</span></div></div><img style="display:block;margin:0;padding:0;border:0;outline:0;width:0;height:0;line-height:0;" alt="" src="https://relay-dsp.ad-m.asia/dmp/sync/bizmatrix?pid=c3ed207b574cf11376&amp;d=x18o8hduaj&amp;uid=" /><div data-hyperapp-app="PersonalPublicArticle" data-hyperapp-props="{&quot;article&quot;:{&quot;body&quot;:&quot;\u003cp\u003e　Qiita全体で数値計算の話題が少なそうだったので、有限要素法（finite element method, FEM）の記事を書いてみました。書き足りなかったり内容が曖昧な所があります。修正リクエストなど書いていただける方、お待ちしております。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;解きたい問題\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E8%A7%A3%E3%81%8D%E3%81%9F%E3%81%84%E5%95%8F%E9%A1%8C\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e解きたい問題\u003c/h2\u003e\n\n\u003cp\u003e$$\\frac{d^2 u(x)}{dx^2} = f(x)~~~   (a \\leq x \\leq b)   \\tag{1}$$\u003cbr\u003e\n$$u(a) = \\alpha,~~~     \\frac{du(b)}{dx} = \\beta   \\tag{2}$$\u003c/p\u003e\n\n\u003cp\u003e　式（1）はPoisson方程式と呼ばれる微分方程式で、静電場や熱伝導などを考える時に出てきます。$x$は位置座標、$f(x)$は既知の関数とし、未知関数である$u(x)$を求めるのが今回の目標です。しかし、微分方程式だけでは解が一意に定まらないため、現実的な計算では何か境界条件を決める必要があります。\u003cbr\u003e\n　そこで、今回設定した境界条件が式（2）です。式（2）の第1式は定義域の左端で$u(x)$の値を直接決めるDirichlet境界条件、式（2）の第2式は定義域の右端で$u(x)$の傾きを決めるNeumann境界条件です。\u003cbr\u003e\n　このように、微分方程式と境界条件からなる問題は、「境界値問題」と呼ばれます。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;厳密解を求める\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E5%8E%B3%E5%AF%86%E8%A7%A3%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e厳密解を求める\u003c/h2\u003e\n\n\u003cp\u003e　$f(x)$が定数の時、この境界値問題の厳密解は手計算で簡単に求められます。あとで有限要素解析プログラムを検証するのに使います。\u003cbr\u003e\n　式（1）の両辺をxで2回積分すると、\u003cbr\u003e\n$$\\frac{du(x)}{dx}  =  fx +C_1,~~~     u(x)  =  \\frac{f}{2}x^2 +C_1 x +C_2$$\u003c/p\u003e\n\n\u003cp\u003e　式（2）を用いると、\u003cbr\u003e\n$$C_1 = -fb +\\beta,~~~     C_2 = -\\frac{f}{2}a^2 -(-fb +\\beta)a +\\alpha$$\u003c/p\u003e\n\n\u003cp\u003e　よって、\u003cbr\u003e\n$$u(x)  =  \\frac{f}{2}x^2 +(-fb +\\beta)x -\\frac{f}{2}a^2 -(-fb +\\beta)a +\\alpha$$\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;近似解の求め方を考える\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E8%BF%91%E4%BC%BC%E8%A7%A3%E3%81%AE%E6%B1%82%E3%82%81%E6%96%B9%E3%82%92%E8%80%83%E3%81%88%E3%82%8B\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e近似解の求め方を考える\u003c/h2\u003e\n\n\u003cp\u003e　微分方程式における関数$u(x)$の近似解を求める場合、非線形の関数で近似したり、フーリエ級数展開や差分法から計算する方法が考えられます。しかし、この精度には限界があります（ギブズ現象や、テイラー展開の打ち切り誤差などが原因）。\u003cbr\u003e\n　それでは、定義域を細かく分割して、分割した領域ごとに関数$u(x)$を近似するのはどうでしょうか。変化が激しい所ほど細かく分割すれば、線形近似でも精度が上がりそうです。そうすると関数$u(x)$は、多数の微小領域ごとで近似された線形関数の集合に置きかえられます。ここで一度、有限要素解析の結果を天下り的に見てしまいましょう。\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\&quot;https://camo.qiitausercontent.com/cb90bce98696748cd4c6a6a2c8f7f2e86ed1edda/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343038342f65636664653439382d393766372d373133342d653435312d3334323336613034616365642e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noopener\&quot;\u003e\u003cimg src=\&quot;https://camo.qiitausercontent.com/cb90bce98696748cd4c6a6a2c8f7f2e86ed1edda/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343038342f65636664653439382d393766372d373133342d653435312d3334323336613034616365642e706e67\&quot; alt=\&quot;Figure_1.png\&quot; data-canonical-src=\&quot;https://qiita-image-store.s3.amazonaws.com/0/114084/ecfde498-97f7-7134-e451-34236a04aced.png\&quot;\u003e\u003c/a\u003e\u003c/p\u003e\n\n\u003cp\u003e　赤線が厳密解、青線が有限要素法で求めた数値解ですが、厳密解にそって線形近似されていることが分かると思います。有限要素法では、まず定義域を多数の「要素」にメッシュ分割し、メッシュの頂点には計算点である「節点」を定義します。定義域を有限個の要素に分割するので、「有限要素法」です。有限要素法で求めるのは、節点上の$u(x)$の値です。それ以外の領域は線形関数などで補完し、解を得たとみなします。有限個の節点上の$u(x)$は、元の境界値問題を線形連立方程式に置きかえてしまうことで計算します。その方法についてはこれから解説します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;支配方程式の弱形式化\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E6%94%AF%E9%85%8D%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E5%BC%B1%E5%BD%A2%E5%BC%8F%E5%8C%96\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e支配方程式の弱形式化\u003c/h2\u003e\n\n\u003cp\u003e　具体的に定式化しましょう。まず支配方程式（1）から残差$R(x)$を定義します。\u003cbr\u003e\n$$R(x) = \\frac{d^2 u(x)}{dx^2} -f(x)  =  0   \\tag{3}$$\u003c/p\u003e\n\n\u003cp\u003e　この時、$u(x)$が真の解であれば$R(x)=0$となりますが、近似解$\\hat{u}(x)$であれば$R(x) \\to 0$となるはずです。そして次に、任意の重み関数$w(x)$を考え、$R(x)$に掛けて定義域内で積分します。この積分は、$R(x) \\to 0$かつ$w(x) \\to 0$になれば0に収束するはずなので、次のように書けます。ただし、Dirichlet境界上では$w(x)=0$とします。\u003cbr\u003e\n$$\\int_a^b R(x) w(x) dx  =  0   \\tag{4}$$\u003c/p\u003e\n\n\u003cp\u003e式（4）より、残差に重みを掛けて積分した時、それが0に収束するような$\\hat{u}(x)$を求めれば、精度のよい近似解を求めたことになります。この辺は数学的に言うと、変分法におけるRayleigh-Ritz法や、重み付き残差法におけるGalerkin法とかと関係してきます。そして驚くべきことに、Rayleigh-Ritz法で定式化した式と、Galerkin法で定式化した式は全く同じ式になります。そのため、2つの名前を折衷して「Ritz-Galerkin法」と呼んだりもします（重みを掛ける詳しい理屈などはよく分かりません、誰か教えてください）。また、元の支配方程式（1）が一度積分されたことで、$u(x)$の微分可能回数の条件が1階だけ弱められています。このことから、式（4）は弱形式とも呼ばれます。\u003c/p\u003e\n\n\u003cp\u003e　もう少し整理しましょう。式（4）の左辺に式（3）を代入して、分解します。\u003cbr\u003e\n$$\\int_a^b \\left[ \\frac{d^2 u(x)}{dx^2} -f(x) \\right] w(x) dx  =  \\int_a^b \\frac{d^2 u(x)}{dx^2} w(x) dx  -\\int_a^b f(x) w(x) dx   \\tag{5}$$\u003c/p\u003e\n\n\u003cp\u003e　ここで1つテクニックを使います。今回は式（5）の右辺第1項に対して、部分積分の式を適用してみましょう（一般的にはガウスの発散定理の式を使います）。これを式（4）に戻すと、次のように書けます。\u003cbr\u003e\n$$\\left[ \\frac{du(x)}{dx} w(x) \\right]^b_a -\\int_a^b \\frac{du(x)}{dx} \\frac{dw(x)}{dx} dx  -\\int_a^b f(x) w(x) dx  =  0   \\tag{6}$$\u003c/p\u003e\n\n\u003cp\u003e　ここで現れた左辺第1項が重要です。境界条件はこの項を利用して入れてやります。ただし、Dirichlet境界上では$w(x)=0$という条件があったので、$\\frac{du(a)}{dx} w(a) = 0$より式（6）はさらに単純化でき、単に次式のようになります。\u003cbr\u003e\n$$\\frac{du(b)}{dx} w(b) -\\int_a^b \\frac{du(x)}{dx} \\frac{dw(x)}{dx} dx  -\\int_a^b f(x) w(x) dx  =  0   \\tag{7}$$\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;弱形式の離散化\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E5%BC%B1%E5%BD%A2%E5%BC%8F%E3%81%AE%E9%9B%A2%E6%95%A3%E5%8C%96\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e弱形式の離散化\u003c/h2\u003e\n\n\u003cp\u003eまずは式（7）の左辺第2項と第3項を、$N$個の領域（要素）に離散化しましょう。\u003cbr\u003e\n$$\\int_a^b \\frac{du(x)}{dx} \\frac{dw(x)}{dx} dx  =  \\sum_{e=0}^{N-1}  \\int_{x_0^e}^{x_1^e} \\frac{du^e(x)}{dx} \\frac{dw^e(x)}{dx} dx   \\tag{8}$$\u003cbr\u003e\n$$\\int_a^b f(x) w(x) dx  =  \\sum_{e=0}^{N-1}  \\int_{x_0^e}^{x_1^e} f^e(x) w^e(x) dx   \\tag{9}$$\u003c/p\u003e\n\n\u003cp\u003e　ただし、$x^e_0,x^e_1$は$e$番目（$e=0,1,\\dots,N-1$）の要素をなす2節点の$x$座標です。ちなみに、番号を0から始めているのは、Pythonの配列番号が0から始まっているのに合わせたためです。\u003cbr\u003e\n この式をさらに離散化するために、要素ごとに「形状関数」というのを定義します。形状関数は各要素の各節点ごとに定義されます。線分要素の場合、1要素につき2節点あるので、形状関数も1要素につき2つ定義されます。形状関数は、定義された節点上で1、それ以外の節点上では0になる関数にします。今回は、$e$番目の要素における形状関数$\\boldsymbol{\\phi}^e(x)$を、次のように線形関数で定義します。\u003cbr\u003e\n$$\\phi_0^e(x) = -\\frac{x-x_1^e}{l^e},~~~~~   \\phi_1^e(x) = \\frac{x-x_0^e}{l^e}$$\u003c/p\u003e\n\n\u003cp\u003e　ただし，$l^e=x_1^e -x_0^e$は線分要素の長さです。ちなみに、$\\phi_0^e(x)$は2点$(x^e_0,1),(x^e_1,0)$を、$\\phi_1^e(x)$は2点$(x^e_0,0),(x^e_1,1)$を通る線分として求めました。そして、この2つの直線の式を1つにまとめると、次のように書けます。\u003cbr\u003e\n$$\\phi_p^e(x)  =  (-1)^{p+1} \\frac{x-x_q^e}{l^e},~~~~~   (p,q)=(0,1),(1,0)   \\tag{10}$$\u003c/p\u003e\n\n\u003cp\u003e　そして、$e$番目の要素内の未知関数$u(x)$および重み関数$w(x)$を、次のように形状関数を用いて離散化します。重み関数は本来任意の関数でよいのですが、形状関数と同じにすると計算精度が上がることが知られているので、そのようにします。\u003cbr\u003e\n$$u^e(x)  =  \\sum_{i=0}^1 u_i^e \\phi_i^e(x)   \\tag{11}$$\u003cbr\u003e\n$$w^e_i(x)  =  \\phi_i^e(x)~~~   (i=0,1)   \\tag{12}$$\u003c/p\u003e\n\n\u003cp\u003e　すると式（8）、（9）は、次のように離散化されます。\u003cbr\u003e\n$$\\sum_{e=0}^{N-1} \\int_{x_0^e}^{x_1^e} u_i^e \\frac{d \\phi_i^e(x)}{dx} \\frac{d \\phi_j^e(x)}{dx}  dx  =  \\sum_{e=0}^{N-1} \\sum_{i=0}^1 \\frac{ (-1)^{i+1} (-1)^{j+1} }{l^e} u_i^e~~~~~   (j=0,1)   \\tag{13}$$\u003cbr\u003e\n$$\\sum_{e=0}^{N-1}  \\int_{x_0^e}^{x_1^e} f^e \\phi_i^e(x) dx  =  \\sum_{e=0}^{N-1} \\sum_{i=0}^1  f^e \\frac{l^e}{2}   \\tag{14}$$\u003c/p\u003e\n\n\u003cp\u003eまた、境界の項に関しては単に次のようになります。\u003cbr\u003e\n$$\\frac{du(b)}{dx} w(b)  =  \\beta$$\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;線形連立方程式の構築\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E7%B7%9A%E5%BD%A2%E9%80%A3%E7%AB%8B%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E6%A7%8B%E7%AF%89\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e線形連立方程式の構築\u003c/h2\u003e\n\n\u003cp\u003e[メモ：local節点とglobal節点との対応の説明を追加する]\u003cbr\u003e\n　この辺はプログラムを見たほうが早いかもしれません。\u003cbr\u003e\n　離散化した式を元に、各要素で成り立つ連立方程式を作ります。これを要素方程式といいます。行列$\\boldsymbol{A}^e$の次数は2です（要素の節点数と同じ）。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;math\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\\begin{bmatrix}\n  A^e_{0,0}\u0026amp; A^e_{0,1}\\\\\n  A^e_{1,0}\u0026amp; A^e_{1,1}\n\\end{bmatrix}\n\\begin{Bmatrix}\n  u^e_0\\\\ u^e_1\n\\end{Bmatrix}\n = \\begin{Bmatrix}\n  b^e_0\\\\ b^e_1\n\\end{Bmatrix}\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$$\\boldsymbol{A}^e  \\boldsymbol{u}^e  =  \\boldsymbol{b}^e$$\u003c/p\u003e\n\n\u003cp\u003e$$A_{ij}^e  =  \\sum_{e=0}^{N-1} \\sum_{i=0}^1 \\frac{ (-1)^{i+1} (-1)^{j+1} }{l^e} u_i^e~~~   (j=0,1),~~~~~     b_i  =  -\\sum_{e=0}^{N-1} \\sum_{i=0}^1  f^e \\frac{l^e}{2}$$\u003c/p\u003e\n\n\u003cp\u003e　次に、要素方程式の行列成分を、全体で成り立つように組み立てなおします。これを全体方程式といいます。行列$\\boldsymbol{A}^e$の次数はNです（全体の節点数と同じ）。\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;math\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\\begin{bmatrix}\n  A_{0,0}\u0026amp;  \\cdots\u0026amp; A_{0,N-1}\\\\\n  \\vdots\u0026amp;  \\ddots\u0026amp; \\vdots\\\\\n  A_{N-1,0}\u0026amp;  \\cdots\u0026amp; A_{N-1,N-1}\n\\end{bmatrix}\n\\begin{Bmatrix}\n  u_0\\\\  \\vdots\\\\  u_{N-1}\n\\end{Bmatrix}\n= \\begin{Bmatrix}\n  b_0\\\\  \\vdots\\\\  b_{N-1}\n\\end{Bmatrix}\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003e$$\\boldsymbol{A}  \\boldsymbol{u}  =  \\boldsymbol{b}$$\u003c/p\u003e\n\n\u003cp\u003e　要素方程式の各成分を、全体方程式の各成分にどう足しこむかが問題になりますが、要素の節点に対応する全体の節点に対して、節点上の値をひも付ければいいです。また、有限要素法で扱う行列は巨大になることも多いため、本来は行列の圧縮形式などを工夫する必要がありますが、今回は説明の簡略化のために省略します。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;境界条件処理\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E5%A2%83%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%87%A6%E7%90%86\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e境界条件処理\u003c/h2\u003e\n\n\u003cp\u003e　この辺もプログラムを見たほうが早いかもしれませんが、\u003cbr\u003e\n　Dirichlet境界条件の処理をする場合は、まず$[\\boldsymbol{A}]$のn行目に$\\alpha$をかけたものを${\\boldsymbol{u}}$から引き、${\\boldsymbol{u}}$のn行目を$\\alpha$にします。そして、$[\\boldsymbol{A}]$の(n,n)成分を1、それ以外のn行とn列成分を0にすれば完了です。\u003cbr\u003e\n　Neumann境界条件を実装する場合は，定義域の端に当たる節点に処理します。${\\boldsymbol{u}}$の$n$行目に$\\beta$を加えれば完了です。\u003c/p\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;プログラム\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003eプログラム\u003c/h2\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;py3\&quot;\u003e\n\u003cdiv class=\&quot;code-lang\&quot;\u003e\u003cspan class=\&quot;bold\&quot;\u003efem1d_poisson01.py\u003c/span\u003e\u003c/div\u003e\n\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\u003cspan class=\&quot;c\&quot;\u003e#1次元ポアソン問題を、有限要素法で解く\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#d^2u(x)/dx^2=f (x_min\u0026lt;x\u0026lt;x_max)\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#u(x_min)=alpha, du(x_max)/dx=beta\u003c/span\u003e\n\u003cspan class=\&quot;kn\&quot;\u003eimport\u003c/span\u003e \u003cspan class=\&quot;nn\&quot;\u003etime\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#時刻を扱うライブラリ\u003c/span\u003e\n\u003cspan class=\&quot;kn\&quot;\u003eimport\u003c/span\u003e \u003cspan class=\&quot;nn\&quot;\u003enumpy\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003eas\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#NumPyライブラリ\u003c/span\u003e\n\u003cspan class=\&quot;kn\&quot;\u003eimport\u003c/span\u003e \u003cspan class=\&quot;nn\&quot;\u003escipy.linalg\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#SciPyの線形計算ライブラリ\u003c/span\u003e\n\u003cspan class=\&quot;kn\&quot;\u003eimport\u003c/span\u003e \u003cspan class=\&quot;nn\&quot;\u003ematplotlib.pyplot\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003eas\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#データ可視化ライブラリ\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;n\&quot;\u003ex_min\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;mf\&quot;\u003e1.0\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#計算領域のXの最小値\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003ex_max\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e1.0\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#計算領域のXの最大値\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e5\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#説点数(\u0026gt;=2)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#要素数\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003efunc_f\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e1.0\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#定数関数f\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#境界条件u(x_min)=alpha,du(x_max)/dx=beta。\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#alphaやbetaが\&quot;inf\&quot;の時は、何も処理しないようにする。\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003ealpha\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e1.0\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#左端のディリクレ境界条件\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003ebeta\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;mf\&quot;\u003e1.0\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#右端のノイマン境界条件\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e#任意の節点に境界条件を実装する\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003edef\u003c/span\u003e \u003cspan class=\&quot;nf\&quot;\u003eboundary\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eDirichlet\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eNeumann\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;c\&quot;\u003e#ディリクレ境界条件\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003eif\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eDirichlet\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e!=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;inf\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#Dirichlet=無限大の時は処理しない\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[:]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eDirichlet\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,:]\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#定数ベクトルの全成分に行の値を移項\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eDirichlet\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#関数を任意の値で固定\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,:]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e0.0\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#行を全て0にする\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[:,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e0.0\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#列を全て0にする\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e1.0\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#対角成分は1にする\u003c/span\u003e\n\n  \u003cspan class=\&quot;c\&quot;\u003e#ノイマン境界条件\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003eif\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eNeumann\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e!=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;inf\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e  \u003cspan class=\&quot;c\&quot;\u003e#Neumann=無限大の時は処理しない\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eNeumann\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#関数を任意の傾きで固定\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e############### 入力データの用意 ###############\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#計算の開始時刻を記録\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003ecompute_time\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etime\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003etime\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e()\u003c/span\u003e\n\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;node_total = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;,  ele_total = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#Global説点のx座標を定義(x_min〜x_max)\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Global node X\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eempty\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#Global説点のx座標\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003elinspace\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_min\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_max\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#計算領域を等分割\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#各要素のGlobal説点番号\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Node number of each elements\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eempty\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e((\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;nb\&quot;\u003eint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#各要素のGlobal説点番号\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e0\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#各要素のLocal説点座標\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Local node X\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003enode_x_ele\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eempty\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e((\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#各要素のLocal説点のx座標\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003enode_x_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_x_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e########## 要素行列を求める ##########\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#各線分要素の長さを計算\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Element length\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003elength\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eempty\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#各要素の長さ\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003elength\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eabsolute\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_x_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_x_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e0\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003elength\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#要素行列の初期化\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003emat_A_ele\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ezeros\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e((\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e3\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e3\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#要素係数行列(ゼロで初期化)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003evec_b_ele\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ezeros\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e((\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e3\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#要素係数ベクトル(ゼロで初期化)\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#要素行列の各成分を計算\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Local matrix\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n    \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003emat_A_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e**\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e**\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elength\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003evec_b_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efunc_f\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003elength\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e\u003cspan class=\&quot;mf\&quot;\u003e2.0\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e########## 全体行列を組み立てる ##########\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#全体行列の初期化\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ezeros\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e((\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#全体係数行列(ゼロで初期化)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ezeros\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efloat64\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#全体係数ベクトル(ゼロで初期化)\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#要素行列から全体行列を組み立てる\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Global matrix (constructed)\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n    \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n      \u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e],\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003emat_A_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\n    \u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enode_num_glo_in_seg_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003evec_b_ele\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ee\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\n\n\u003cspan class=\&quot;k\&quot;\u003eif\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e20\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#節点数が20未満の時、全体行列を確認\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n    \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n      \u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;{:6.2f}\&quot;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eformat\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eend\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n    \u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;;{:6.2f}\&quot;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eformat\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]))\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e############### 境界条件処理 ###############\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Boundary conditions\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eboundary\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e0\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ealpha\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;mf\&quot;\u003e0.0\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#左端はディリクレ境界\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eboundary\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e1\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;inf\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ebeta\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#右端はノイマン境界\u003c/span\u003e\n\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Post global matrix\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#節点数が20未満の時、全体行列を確認\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eif\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e20\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n  \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n    \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e\n      \u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;{:6.2f}\&quot;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eformat\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ej\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]),\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eend\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n    \u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;;{:6.2f}\&quot;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eformat\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ei\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e]))\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e############### 連立方程式を解く ###############\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;node_total = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;,  ele_total = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eele_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#print(\&quot;detA = \&quot;, scipy.linalg.det(mat_A_glo)) #Aの行列式\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#print(\&quot;Rank A = \&quot;, np.linalg.matrix_rank(mat_A_glo)) #AのRank(階数)\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#print(\&quot;Inverse A = \&quot;, scipy.linalg.inv(mat_A_glo)) #Aの逆行列\u003c/span\u003e\n\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Unkown vector u = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#未知数ベクトル\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003escipy\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003elinalg\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003esolve\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003emat_A_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003evec_b_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#Au=bから、未知数ベクトルuを求める\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Max u = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003emax\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e),\u003c/span\u003e \u003cspan class=\&quot;s\&quot;\u003e\&quot;,  Min u = \&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;nb\&quot;\u003emin\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e))\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#uの最大値、最小値\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#計算時間の表示\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003ecompute_time\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003etime\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003etime\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e()\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ecompute_time\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003eprint\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Compute_time: {:0.5f}[sec]\&quot;\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eformat\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ecompute_time\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e))\u003c/span\u003e\n\n\n\n\u003cspan class=\&quot;c\&quot;\u003e############### 計算結果を可視化 ###############\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#plt.rcParams[&#39;font.family&#39;] = &#39;Times New Roman&#39; #全体のフォントを設定\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003etitle\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;Finite element analysis of 1D Poisson&#39;s equation\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#グラフタイトル\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003exlabel\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;$x$\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#x軸の名前\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eylabel\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;$u(x)$\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#y軸の名前\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003egrid\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e()\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#点線の目盛りを表示\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#厳密解をプロット\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eexact_x\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003enp\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003earange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_min\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_max\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;mf\&quot;\u003e0.01\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eexact_y\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efunc_f\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eexact_x\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e**\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efunc_f\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_max\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebeta\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eexact_x\u003c/span\u003e \\\n          \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efunc_f\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e/\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_min\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e**\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e2\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e-\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003efunc_f\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_max\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ebeta\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ex_min\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003ealpha\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eplot\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eexact_x\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eexact_y\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;$u(x)$\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecolor\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;#ff0000&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#折線グラフを作成\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#近似解をプロット\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eplot\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003elabel\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;$\u003c/span\u003e\u003cspan class=\&quot;err\&quot;\u003e\\\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003ehat{u}(x)$\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecolor\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;#0000ff&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#折線グラフを作成\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003escatter\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#点グラフを作成\u003c/span\u003e\n\n\u003cspan class=\&quot;c\&quot;\u003e#更に体裁を整える\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eaxis\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e\&quot;tight\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#余白を狭くする\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#plt.axis(\&quot;image\&quot;) #座標のアスペクト比を維持して余白を狭くする\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eaxhline\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e0\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecolor\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;#000000&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#x軸(y=0)の線\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eaxvline\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;mi\&quot;\u003e0\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecolor\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;#000000&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#y軸(x=0)の線\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003elegend\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eloc\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;best&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#凡例(グラフラベル)を表示\u003c/span\u003e\n\u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003en\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003erange\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_total\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e):\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#節点番号をグラフ内に表示\u003c/span\u003e\n  \u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003etext\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003enode_x_glo\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003en\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e],\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eunknown_vec_u\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003en\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e],\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003en\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003eha\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;center&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eva\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;bottom&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecolor\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e\u003cspan class=\&quot;s\&quot;\u003e&#39;#0000ff&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003eplt\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eshow\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e()\u003c/span\u003e \u003cspan class=\&quot;c\&quot;\u003e#グラフを表示\u003c/span\u003e\n\u003cspan class=\&quot;c\&quot;\u003e#plt.savefig(\&quot;fem1d_poisson.png\&quot;)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\n\u003c/div\u003e\n\n\u003ch2\u003e\n\u003cspan id=\&quot;資料とか\&quot; class=\&quot;fragment\&quot;\u003e\u003c/span\u003e\u003ca href=\&quot;#%E8%B3%87%E6%96%99%E3%81%A8%E3%81%8B\&quot;\u003e\u003ci class=\&quot;fa fa-link\&quot;\u003e\u003c/i\u003e\u003c/a\u003e資料とか\u003c/h2\u003e\n\n\u003cp\u003e\u003ca href=\&quot;http://www.multi.k.u-tokyo.ac.jp/lectures/pukiwiki/index.php?plugin=attach\u0026amp;pcmd=open\u0026amp;file=1%E6%AC%A1%E5%85%83%E5%95%8F%E9%A1%8C%E3%81%AE%E6%9C%89%E9%99%90%E8%A6%81%E7%B4%A0%E6%B3%95.pdf\u0026amp;refer=HPC%E8%B3%87%E6%96%99\u0026amp;age=1\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003e奥田洋司, 1次元問題の有限要素法, 東京大学大学院, (2006).\u003c/a\u003e\u003cbr\u003e\n菊地文雄, 有限要素法概説 理工学における基礎と応用, コロナ社, (1999).\u003cbr\u003e\nJ. L. Volakis, A. Chatterjee, and L. C. Kempel, Finite Element Method for Electromagnetics, Wiley-IEEE Press, (1998).\u003cbr\u003e\n日本建築学会編, はじめての音響数値シミュレーション プログラミングガイド, コロナ社, (2012).\u003c/p\u003e\n&quot;,&quot;createdAt&quot;:&quot;2017-12-01T14:31:41Z&quot;,&quot;elapsedYearsFromUpdatedAt&quot;:0,&quot;isDeprecated&quot;:false,&quot;isDestroyableByViewer&quot;:false,&quot;isEditRequestSendableByViewer&quot;:true,&quot;isLikableByViewer&quot;:true,&quot;isLikedByViewer&quot;:false,&quot;isPublic&quot;:true,&quot;isSlide&quot;:false,&quot;isStockableByViewer&quot;:true,&quot;isStockedByViewer&quot;:false,&quot;isUpdatableByViewer&quot;:false,&quot;isUpdated&quot;:true,&quot;likesCount&quot;:17,&quot;originalId&quot;:557940,&quot;title&quot;:&quot;Pythonで1次元有限要素解析（Poisson方程式）&quot;,&quot;toc&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%A7%A3%E3%81%8D%E3%81%9F%E3%81%84%E5%95%8F%E9%A1%8C\&quot;\u003e解きたい問題\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%8E%B3%E5%AF%86%E8%A7%A3%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B\&quot;\u003e厳密解を求める\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%BF%91%E4%BC%BC%E8%A7%A3%E3%81%AE%E6%B1%82%E3%82%81%E6%96%B9%E3%82%92%E8%80%83%E3%81%88%E3%82%8B\&quot;\u003e近似解の求め方を考える\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%94%AF%E9%85%8D%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E5%BC%B1%E5%BD%A2%E5%BC%8F%E5%8C%96\&quot;\u003e支配方程式の弱形式化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%BC%B1%E5%BD%A2%E5%BC%8F%E3%81%AE%E9%9B%A2%E6%95%A3%E5%8C%96\&quot;\u003e弱形式の離散化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E7%B7%9A%E5%BD%A2%E9%80%A3%E7%AB%8B%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E6%A7%8B%E7%AF%89\&quot;\u003e線形連立方程式の構築\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%A2%83%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%87%A6%E7%90%86\&quot;\u003e境界条件処理\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0\&quot;\u003eプログラム\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%B3%87%E6%96%99%E3%81%A8%E3%81%8B\&quot;\u003e資料とか\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;totalPv&quot;:1868,&quot;updatedAt&quot;:&quot;2018-06-16T17:11:32Z&quot;,&quot;uuid&quot;:&quot;4c4ddc25609a7619cce0&quot;,&quot;adventCalendarItem&quot;:{&quot;day&quot;:3,&quot;calendar&quot;:{&quot;name&quot;:&quot;数学とコンピュータⅡ&quot;,&quot;urlName&quot;:&quot;math-and-computer2&quot;,&quot;year&quot;:2017,&quot;organization&quot;:null}},&quot;author&quot;:{&quot;description&quot;:null,&quot;name&quot;:&quot;&quot;,&quot;profileImageUrl&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/114084/profile-images/1473712473&quot;,&quot;urlName&quot;:&quot;Sunset_Yuhi&quot;,&quot;isFollowedByViewer&quot;:false,&quot;isFollowableByViewer&quot;:true,&quot;websiteUrl&quot;:null,&quot;organizations&quot;:{&quot;edges&quot;:[]}},&quot;tags&quot;:[{&quot;name&quot;:&quot;Python&quot;,&quot;urlName&quot;:&quot;python&quot;},{&quot;name&quot;:&quot;数値計算&quot;,&quot;urlName&quot;:&quot;%e6%95%b0%e5%80%a4%e8%a8%88%e7%ae%97&quot;},{&quot;name&quot;:&quot;scipy&quot;,&quot;urlName&quot;:&quot;scipy&quot;},{&quot;name&quot;:&quot;有限要素法&quot;,&quot;urlName&quot;:&quot;%e6%9c%89%e9%99%90%e8%a6%81%e7%b4%a0%e6%b3%95&quot;},{&quot;name&quot;:&quot;FEM&quot;,&quot;urlName&quot;:&quot;fem&quot;}],&quot;followingLikers&quot;:{&quot;edges&quot;:[]},&quot;comments&quot;:{&quot;totalCount&quot;:5}},&quot;analyticsTrackingId&quot;:null}"><article itemscope="itemscope" itemtype="http://schema.org/Article" class="p-items"><div class="p-items_wrapper"><div class="p-items_container"><div class="p-items_stickyMenu it-Actions"><div class="it-Actions_item it-Actions_item-like likable"><a class="it-Actions_likeCount" href="/Sunset_Yuhi/items/4c4ddc25609a7619cce0/likers">17</a><button><i class="fa fa-fw fa-thumbs-up"></i></button></div><div class="it-Actions_item it-Actions_item-stock"><button><i class="fa fa-folder-open"></i></button></div><div class="it-Actions_jumpToCommentButton"><div class="it-Actions_commentCount"></div><div class="fa fa-fw fa-comment"></div></div><div class="it-Actions_shareButton it-Actions_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Actions_shareButton it-Actions_shareButton-facebook"><span class="fa fa-facebook"></span></div></div><div class="p-items_main"><div class="p-items_article"><div class="it-Header"><div class="u-flex-center-between mb-3"><div class="it-Header_info"><div class="it-Header_author"><a href="/Sunset_Yuhi"><img class="it-Header_authorImage" src="https://qiita-image-store.s3.amazonaws.com/0/114084/profile-images/1473712473" alt="1473712473" /></a><a class="it-Header_authorName" href="/Sunset_Yuhi">@Sunset_Yuhi</a> </div><div class="it-Header_time"></div><div class="it-Header_meta"><div class="it-Header_manipulate"><div class="dropdown"><span class="dropdown-toggle" tabindex="0"><span class="fa fa-ellipsis-h fa-lg"></span></span></div></div></div></div></div><div class="it-AdcalRibbon"><span><a class="it-AdcalRibbon_title" href="/advent-calendar/2017/math-and-computer2">数学とコンピュータⅡ</a>3日目</span></div><h1 class="it-Header_title" itemprop="headline">Pythonで1次元有限要素解析（Poisson方程式）</h1><div class="it-Tags"><a class="it-Tags_item" href="/tags/python"><span>Python</span></a><a class="it-Tags_item" href="/tags/%25e6%2595%25b0%25e5%2580%25a4%25e8%25a8%2588%25e7%25ae%2597"><span>数値計算</span></a><a class="it-Tags_item" href="/tags/scipy"><span>scipy</span></a><a class="it-Tags_item" href="/tags/%25e6%259c%2589%25e9%2599%2590%25e8%25a6%2581%25e7%25b4%25a0%25e6%25b3%2595"><span>有限要素法</span></a><a class="it-Tags_item" href="/tags/fem"><span>FEM</span></a></div></div><div class="it-ActionsMobile"><div class="it-ActionsMobile_like likable"><button><span class="fa fa-fw fa-thumbs-up" /><span>17</span></button></div><div class="it-ActionsMobile_stock"><button><div class="fa fa-folder-open"></div></button></div></div><section class="it-MdContent" itemprop="articleBody"><div id="item-4c4ddc25609a7619cce0"><p>　Qiita全体で数値計算の話題が少なそうだったので、有限要素法（finite element method, FEM）の記事を書いてみました。書き足りなかったり内容が曖昧な所があります。修正リクエストなど書いていただける方、お待ちしております。</p>

<h2>
<span id="解きたい問題" class="fragment"></span><a href="#%E8%A7%A3%E3%81%8D%E3%81%9F%E3%81%84%E5%95%8F%E9%A1%8C"><i class="fa fa-link"></i></a>解きたい問題</h2>

<p>$$\frac{d^2 u(x)}{dx^2} = f(x)~~~   (a \leq x \leq b)   \tag{1}$$<br>
$$u(a) = \alpha,~~~     \frac{du(b)}{dx} = \beta   \tag{2}$$</p>

<p>　式（1）はPoisson方程式と呼ばれる微分方程式で、静電場や熱伝導などを考える時に出てきます。$x$は位置座標、$f(x)$は既知の関数とし、未知関数である$u(x)$を求めるのが今回の目標です。しかし、微分方程式だけでは解が一意に定まらないため、現実的な計算では何か境界条件を決める必要があります。<br>
　そこで、今回設定した境界条件が式（2）です。式（2）の第1式は定義域の左端で$u(x)$の値を直接決めるDirichlet境界条件、式（2）の第2式は定義域の右端で$u(x)$の傾きを決めるNeumann境界条件です。<br>
　このように、微分方程式と境界条件からなる問題は、「境界値問題」と呼ばれます。</p>

<h2>
<span id="厳密解を求める" class="fragment"></span><a href="#%E5%8E%B3%E5%AF%86%E8%A7%A3%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B"><i class="fa fa-link"></i></a>厳密解を求める</h2>

<p>　$f(x)$が定数の時、この境界値問題の厳密解は手計算で簡単に求められます。あとで有限要素解析プログラムを検証するのに使います。<br>
　式（1）の両辺をxで2回積分すると、<br>
$$\frac{du(x)}{dx}  =  fx +C_1,~~~     u(x)  =  \frac{f}{2}x^2 +C_1 x +C_2$$</p>

<p>　式（2）を用いると、<br>
$$C_1 = -fb +\beta,~~~     C_2 = -\frac{f}{2}a^2 -(-fb +\beta)a +\alpha$$</p>

<p>　よって、<br>
$$u(x)  =  \frac{f}{2}x^2 +(-fb +\beta)x -\frac{f}{2}a^2 -(-fb +\beta)a +\alpha$$</p>

<h2>
<span id="近似解の求め方を考える" class="fragment"></span><a href="#%E8%BF%91%E4%BC%BC%E8%A7%A3%E3%81%AE%E6%B1%82%E3%82%81%E6%96%B9%E3%82%92%E8%80%83%E3%81%88%E3%82%8B"><i class="fa fa-link"></i></a>近似解の求め方を考える</h2>

<p>　微分方程式における関数$u(x)$の近似解を求める場合、非線形の関数で近似したり、フーリエ級数展開や差分法から計算する方法が考えられます。しかし、この精度には限界があります（ギブズ現象や、テイラー展開の打ち切り誤差などが原因）。<br>
　それでは、定義域を細かく分割して、分割した領域ごとに関数$u(x)$を近似するのはどうでしょうか。変化が激しい所ほど細かく分割すれば、線形近似でも精度が上がりそうです。そうすると関数$u(x)$は、多数の微小領域ごとで近似された線形関数の集合に置きかえられます。ここで一度、有限要素解析の結果を天下り的に見てしまいましょう。</p>

<p><a href="https://camo.qiitausercontent.com/cb90bce98696748cd4c6a6a2c8f7f2e86ed1edda/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343038342f65636664653439382d393766372d373133342d653435312d3334323336613034616365642e706e67" target="_blank" rel="nofollow noopener"><img src="https://camo.qiitausercontent.com/cb90bce98696748cd4c6a6a2c8f7f2e86ed1edda/68747470733a2f2f71696974612d696d6167652d73746f72652e73332e616d617a6f6e6177732e636f6d2f302f3131343038342f65636664653439382d393766372d373133342d653435312d3334323336613034616365642e706e67" alt="Figure_1.png" data-canonical-src="https://qiita-image-store.s3.amazonaws.com/0/114084/ecfde498-97f7-7134-e451-34236a04aced.png"></a></p>

<p>　赤線が厳密解、青線が有限要素法で求めた数値解ですが、厳密解にそって線形近似されていることが分かると思います。有限要素法では、まず定義域を多数の「要素」にメッシュ分割し、メッシュの頂点には計算点である「節点」を定義します。定義域を有限個の要素に分割するので、「有限要素法」です。有限要素法で求めるのは、節点上の$u(x)$の値です。それ以外の領域は線形関数などで補完し、解を得たとみなします。有限個の節点上の$u(x)$は、元の境界値問題を線形連立方程式に置きかえてしまうことで計算します。その方法についてはこれから解説します。</p>

<h2>
<span id="支配方程式の弱形式化" class="fragment"></span><a href="#%E6%94%AF%E9%85%8D%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E5%BC%B1%E5%BD%A2%E5%BC%8F%E5%8C%96"><i class="fa fa-link"></i></a>支配方程式の弱形式化</h2>

<p>　具体的に定式化しましょう。まず支配方程式（1）から残差$R(x)$を定義します。<br>
$$R(x) = \frac{d^2 u(x)}{dx^2} -f(x)  =  0   \tag{3}$$</p>

<p>　この時、$u(x)$が真の解であれば$R(x)=0$となりますが、近似解$\hat{u}(x)$であれば$R(x) \to 0$となるはずです。そして次に、任意の重み関数$w(x)$を考え、$R(x)$に掛けて定義域内で積分します。この積分は、$R(x) \to 0$かつ$w(x) \to 0$になれば0に収束するはずなので、次のように書けます。ただし、Dirichlet境界上では$w(x)=0$とします。<br>
$$\int_a^b R(x) w(x) dx  =  0   \tag{4}$$</p>

<p>式（4）より、残差に重みを掛けて積分した時、それが0に収束するような$\hat{u}(x)$を求めれば、精度のよい近似解を求めたことになります。この辺は数学的に言うと、変分法におけるRayleigh-Ritz法や、重み付き残差法におけるGalerkin法とかと関係してきます。そして驚くべきことに、Rayleigh-Ritz法で定式化した式と、Galerkin法で定式化した式は全く同じ式になります。そのため、2つの名前を折衷して「Ritz-Galerkin法」と呼んだりもします（重みを掛ける詳しい理屈などはよく分かりません、誰か教えてください）。また、元の支配方程式（1）が一度積分されたことで、$u(x)$の微分可能回数の条件が1階だけ弱められています。このことから、式（4）は弱形式とも呼ばれます。</p>

<p>　もう少し整理しましょう。式（4）の左辺に式（3）を代入して、分解します。<br>
$$\int_a^b \left[ \frac{d^2 u(x)}{dx^2} -f(x) \right] w(x) dx  =  \int_a^b \frac{d^2 u(x)}{dx^2} w(x) dx  -\int_a^b f(x) w(x) dx   \tag{5}$$</p>

<p>　ここで1つテクニックを使います。今回は式（5）の右辺第1項に対して、部分積分の式を適用してみましょう（一般的にはガウスの発散定理の式を使います）。これを式（4）に戻すと、次のように書けます。<br>
$$\left[ \frac{du(x)}{dx} w(x) \right]^b_a -\int_a^b \frac{du(x)}{dx} \frac{dw(x)}{dx} dx  -\int_a^b f(x) w(x) dx  =  0   \tag{6}$$</p>

<p>　ここで現れた左辺第1項が重要です。境界条件はこの項を利用して入れてやります。ただし、Dirichlet境界上では$w(x)=0$という条件があったので、$\frac{du(a)}{dx} w(a) = 0$より式（6）はさらに単純化でき、単に次式のようになります。<br>
$$\frac{du(b)}{dx} w(b) -\int_a^b \frac{du(x)}{dx} \frac{dw(x)}{dx} dx  -\int_a^b f(x) w(x) dx  =  0   \tag{7}$$</p>

<h2>
<span id="弱形式の離散化" class="fragment"></span><a href="#%E5%BC%B1%E5%BD%A2%E5%BC%8F%E3%81%AE%E9%9B%A2%E6%95%A3%E5%8C%96"><i class="fa fa-link"></i></a>弱形式の離散化</h2>

<p>まずは式（7）の左辺第2項と第3項を、$N$個の領域（要素）に離散化しましょう。<br>
$$\int_a^b \frac{du(x)}{dx} \frac{dw(x)}{dx} dx  =  \sum_{e=0}^{N-1}  \int_{x_0^e}^{x_1^e} \frac{du^e(x)}{dx} \frac{dw^e(x)}{dx} dx   \tag{8}$$<br>
$$\int_a^b f(x) w(x) dx  =  \sum_{e=0}^{N-1}  \int_{x_0^e}^{x_1^e} f^e(x) w^e(x) dx   \tag{9}$$</p>

<p>　ただし、$x^e_0,x^e_1$は$e$番目（$e=0,1,\dots,N-1$）の要素をなす2節点の$x$座標です。ちなみに、番号を0から始めているのは、Pythonの配列番号が0から始まっているのに合わせたためです。<br>
 この式をさらに離散化するために、要素ごとに「形状関数」というのを定義します。形状関数は各要素の各節点ごとに定義されます。線分要素の場合、1要素につき2節点あるので、形状関数も1要素につき2つ定義されます。形状関数は、定義された節点上で1、それ以外の節点上では0になる関数にします。今回は、$e$番目の要素における形状関数$\boldsymbol{\phi}^e(x)$を、次のように線形関数で定義します。<br>
$$\phi_0^e(x) = -\frac{x-x_1^e}{l^e},~~~~~   \phi_1^e(x) = \frac{x-x_0^e}{l^e}$$</p>

<p>　ただし，$l^e=x_1^e -x_0^e$は線分要素の長さです。ちなみに、$\phi_0^e(x)$は2点$(x^e_0,1),(x^e_1,0)$を、$\phi_1^e(x)$は2点$(x^e_0,0),(x^e_1,1)$を通る線分として求めました。そして、この2つの直線の式を1つにまとめると、次のように書けます。<br>
$$\phi_p^e(x)  =  (-1)^{p+1} \frac{x-x_q^e}{l^e},~~~~~   (p,q)=(0,1),(1,0)   \tag{10}$$</p>

<p>　そして、$e$番目の要素内の未知関数$u(x)$および重み関数$w(x)$を、次のように形状関数を用いて離散化します。重み関数は本来任意の関数でよいのですが、形状関数と同じにすると計算精度が上がることが知られているので、そのようにします。<br>
$$u^e(x)  =  \sum_{i=0}^1 u_i^e \phi_i^e(x)   \tag{11}$$<br>
$$w^e_i(x)  =  \phi_i^e(x)~~~   (i=0,1)   \tag{12}$$</p>

<p>　すると式（8）、（9）は、次のように離散化されます。<br>
$$\sum_{e=0}^{N-1} \int_{x_0^e}^{x_1^e} u_i^e \frac{d \phi_i^e(x)}{dx} \frac{d \phi_j^e(x)}{dx}  dx  =  \sum_{e=0}^{N-1} \sum_{i=0}^1 \frac{ (-1)^{i+1} (-1)^{j+1} }{l^e} u_i^e~~~~~   (j=0,1)   \tag{13}$$<br>
$$\sum_{e=0}^{N-1}  \int_{x_0^e}^{x_1^e} f^e \phi_i^e(x) dx  =  \sum_{e=0}^{N-1} \sum_{i=0}^1  f^e \frac{l^e}{2}   \tag{14}$$</p>

<p>また、境界の項に関しては単に次のようになります。<br>
$$\frac{du(b)}{dx} w(b)  =  \beta$$</p>

<h2>
<span id="線形連立方程式の構築" class="fragment"></span><a href="#%E7%B7%9A%E5%BD%A2%E9%80%A3%E7%AB%8B%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>線形連立方程式の構築</h2>

<p>[メモ：local節点とglobal節点との対応の説明を追加する]<br>
　この辺はプログラムを見たほうが早いかもしれません。<br>
　離散化した式を元に、各要素で成り立つ連立方程式を作ります。これを要素方程式といいます。行列$\boldsymbol{A}^e$の次数は2です（要素の節点数と同じ）。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre>\begin{bmatrix}
  A^e_{0,0}&amp; A^e_{0,1}\\
  A^e_{1,0}&amp; A^e_{1,1}
\end{bmatrix}
\begin{Bmatrix}
  u^e_0\\ u^e_1
\end{Bmatrix}
 = \begin{Bmatrix}
  b^e_0\\ b^e_1
\end{Bmatrix}
</pre></div></div>

<p>$$\boldsymbol{A}^e  \boldsymbol{u}^e  =  \boldsymbol{b}^e$$</p>

<p>$$A_{ij}^e  =  \sum_{e=0}^{N-1} \sum_{i=0}^1 \frac{ (-1)^{i+1} (-1)^{j+1} }{l^e} u_i^e~~~   (j=0,1),~~~~~     b_i  =  -\sum_{e=0}^{N-1} \sum_{i=0}^1  f^e \frac{l^e}{2}$$</p>

<p>　次に、要素方程式の行列成分を、全体で成り立つように組み立てなおします。これを全体方程式といいます。行列$\boldsymbol{A}^e$の次数はNです（全体の節点数と同じ）。</p>

<div class="code-frame" data-lang="math"><div class="highlight"><pre>\begin{bmatrix}
  A_{0,0}&amp;  \cdots&amp; A_{0,N-1}\\
  \vdots&amp;  \ddots&amp; \vdots\\
  A_{N-1,0}&amp;  \cdots&amp; A_{N-1,N-1}
\end{bmatrix}
\begin{Bmatrix}
  u_0\\  \vdots\\  u_{N-1}
\end{Bmatrix}
= \begin{Bmatrix}
  b_0\\  \vdots\\  b_{N-1}
\end{Bmatrix}
</pre></div></div>

<p>$$\boldsymbol{A}  \boldsymbol{u}  =  \boldsymbol{b}$$</p>

<p>　要素方程式の各成分を、全体方程式の各成分にどう足しこむかが問題になりますが、要素の節点に対応する全体の節点に対して、節点上の値をひも付ければいいです。また、有限要素法で扱う行列は巨大になることも多いため、本来は行列の圧縮形式などを工夫する必要がありますが、今回は説明の簡略化のために省略します。</p>

<h2>
<span id="境界条件処理" class="fragment"></span><a href="#%E5%A2%83%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%87%A6%E7%90%86"><i class="fa fa-link"></i></a>境界条件処理</h2>

<p>　この辺もプログラムを見たほうが早いかもしれませんが、<br>
　Dirichlet境界条件の処理をする場合は、まず$[\boldsymbol{A}]$のn行目に$\alpha$をかけたものを${\boldsymbol{u}}$から引き、${\boldsymbol{u}}$のn行目を$\alpha$にします。そして、$[\boldsymbol{A}]$の(n,n)成分を1、それ以外のn行とn列成分を0にすれば完了です。<br>
　Neumann境界条件を実装する場合は，定義域の端に当たる節点に処理します。${\boldsymbol{u}}$の$n$行目に$\beta$を加えれば完了です。</p>

<h2>
<span id="プログラム" class="fragment"></span><a href="#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0"><i class="fa fa-link"></i></a>プログラム</h2>

<div class="code-frame" data-lang="py3">
<div class="code-lang"><span class="bold">fem1d_poisson01.py</span></div>
<div class="highlight"><pre><span class="c">#1次元ポアソン問題を、有限要素法で解く</span>
<span class="c">#d^2u(x)/dx^2=f (x_min&lt;x&lt;x_max)</span>
<span class="c">#u(x_min)=alpha, du(x_max)/dx=beta</span>
<span class="kn">import</span> <span class="nn">time</span>  <span class="c">#時刻を扱うライブラリ</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>  <span class="c">#NumPyライブラリ</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span>  <span class="c">#SciPyの線形計算ライブラリ</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>  <span class="c">#データ可視化ライブラリ</span>



<span class="n">x_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="c">#計算領域のXの最小値</span>
<span class="n">x_max</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c">#計算領域のXの最大値</span>

<span class="n">node_total</span> <span class="o">=</span> <span class="mi">5</span> <span class="c">#説点数(&gt;=2)</span>
<span class="n">ele_total</span> <span class="o">=</span> <span class="n">node_total</span><span class="o">-</span><span class="mi">1</span> <span class="c">#要素数</span>

<span class="n">func_f</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c">#定数関数f</span>

<span class="c">#境界条件u(x_min)=alpha,du(x_max)/dx=beta。</span>
<span class="c">#alphaやbetaが"inf"の時は、何も処理しないようにする。</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c">#左端のディリクレ境界条件</span>
<span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="c">#右端のノイマン境界条件</span>



<span class="c">#任意の節点に境界条件を実装する</span>
<span class="k">def</span> <span class="nf">boundary</span><span class="p">(</span><span class="n">node_num_glo</span><span class="p">,</span> <span class="n">Dirichlet</span><span class="p">,</span> <span class="n">Neumann</span><span class="p">):</span>
  <span class="c">#ディリクレ境界条件</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Dirichlet</span><span class="o">!=</span><span class="s">"inf"</span><span class="p">):</span>  <span class="c">#Dirichlet=無限大の時は処理しない</span>
    <span class="n">vec_b_glo</span><span class="p">[:]</span> <span class="o">-=</span> <span class="n">Dirichlet</span><span class="o">*</span><span class="n">mat_A_glo</span><span class="p">[</span><span class="n">node_num_glo</span><span class="p">,:]</span>  <span class="c">#定数ベクトルの全成分に行の値を移項</span>
    <span class="n">vec_b_glo</span><span class="p">[</span><span class="n">node_num_glo</span><span class="p">]</span> <span class="o">=</span> <span class="n">Dirichlet</span>  <span class="c">#関数を任意の値で固定</span>
    <span class="n">mat_A_glo</span><span class="p">[</span><span class="n">node_num_glo</span><span class="p">,:]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c">#行を全て0にする</span>
    <span class="n">mat_A_glo</span><span class="p">[:,</span><span class="n">node_num_glo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c">#列を全て0にする</span>
    <span class="n">mat_A_glo</span><span class="p">[</span><span class="n">node_num_glo</span><span class="p">,</span><span class="n">node_num_glo</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c">#対角成分は1にする</span>

  <span class="c">#ノイマン境界条件</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Neumann</span><span class="o">!=</span><span class="s">"inf"</span><span class="p">):</span>  <span class="c">#Neumann=無限大の時は処理しない</span>
    <span class="n">vec_b_glo</span><span class="p">[</span><span class="n">node_num_glo</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Neumann</span> <span class="c">#関数を任意の傾きで固定</span>



<span class="c">############### 入力データの用意 ###############</span>
<span class="c">#計算の開始時刻を記録</span>
<span class="n">compute_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s">"node_total = "</span><span class="p">,</span><span class="n">node_total</span><span class="p">,</span> <span class="s">",  ele_total = "</span><span class="p">,</span><span class="n">ele_total</span><span class="p">)</span>

<span class="c">#Global説点のx座標を定義(x_min〜x_max)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Global node X"</span><span class="p">)</span>
<span class="n">node_x_glo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">node_total</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#Global説点のx座標</span>
<span class="n">node_x_glo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span> <span class="n">node_total</span><span class="p">)</span> <span class="c">#計算領域を等分割</span>
<span class="k">print</span><span class="p">(</span><span class="n">node_x_glo</span><span class="p">)</span>

<span class="c">#各要素のGlobal説点番号</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Node number of each elements"</span><span class="p">)</span>
<span class="n">node_num_glo_in_seg_ele</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ele_total</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="nb">int</span><span class="p">)</span> <span class="c">#各要素のGlobal説点番号</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ele_total</span><span class="p">):</span>
  <span class="n">node_num_glo_in_seg_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span>
  <span class="n">node_num_glo_in_seg_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="o">+</span><span class="mi">1</span>
<span class="k">print</span><span class="p">(</span><span class="n">node_num_glo_in_seg_ele</span><span class="p">)</span>

<span class="c">#各要素のLocal説点座標</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Local node X"</span><span class="p">)</span>
<span class="n">node_x_ele</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">ele_total</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#各要素のLocal説点のx座標</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ele_total</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">node_x_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">node_x_glo</span><span class="p">[</span> <span class="n">node_num_glo_in_seg_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">node_x_ele</span><span class="p">)</span>



<span class="c">########## 要素行列を求める ##########</span>
<span class="c">#各線分要素の長さを計算</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Element length"</span><span class="p">)</span>
<span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ele_total</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#各要素の長さ</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ele_total</span><span class="p">):</span>
  <span class="n">length</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span> <span class="n">node_x_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="n">node_x_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

<span class="c">#要素行列の初期化</span>
<span class="n">mat_A_ele</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ele_total</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#要素係数行列(ゼロで初期化)</span>
<span class="n">vec_b_ele</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ele_total</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#要素係数ベクトル(ゼロで初期化)</span>

<span class="c">#要素行列の各成分を計算</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Local matrix"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ele_total</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
      <span class="n">mat_A_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="n">length</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
    <span class="n">vec_b_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">func_f</span> <span class="o">*</span><span class="n">length</span><span class="p">[</span><span class="n">e</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span>



<span class="c">########## 全体行列を組み立てる ##########</span>
<span class="c">#全体行列の初期化</span>
<span class="n">mat_A_glo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">node_total</span><span class="p">,</span><span class="n">node_total</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#全体係数行列(ゼロで初期化)</span>
<span class="n">vec_b_glo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">node_total</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="c">#全体係数ベクトル(ゼロで初期化)</span>

<span class="c">#要素行列から全体行列を組み立てる</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Global matrix (constructed)"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ele_total</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
      <span class="n">mat_A_glo</span><span class="p">[</span> <span class="n">node_num_glo_in_seg_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">],</span> <span class="n">node_num_glo_in_seg_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">mat_A_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="n">vec_b_glo</span><span class="p">[</span> <span class="n">node_num_glo_in_seg_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="o">+=</span> <span class="n">vec_b_ele</span><span class="p">[</span><span class="n">e</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node_total</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">):</span> <span class="c">#節点数が20未満の時、全体行列を確認</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_total</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_total</span><span class="p">):</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"{:6.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mat_A_glo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">";{:6.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vec_b_glo</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>



<span class="c">############### 境界条件処理 ###############</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Boundary conditions"</span><span class="p">)</span>
<span class="n">boundary</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="c">#左端はディリクレ境界</span>
<span class="n">boundary</span><span class="p">(</span><span class="n">node_total</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">"inf"</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span> <span class="c">#右端はノイマン境界</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Post global matrix"</span><span class="p">)</span> <span class="c">#節点数が20未満の時、全体行列を確認</span>
<span class="k">if</span> <span class="p">(</span><span class="n">node_total</span><span class="o">&lt;</span><span class="mi">20</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_total</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_total</span><span class="p">):</span>
      <span class="k">print</span><span class="p">(</span><span class="s">"{:6.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mat_A_glo</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">";{:6.2f}"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vec_b_glo</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>



<span class="c">############### 連立方程式を解く ###############</span>
<span class="k">print</span><span class="p">(</span><span class="s">"node_total = "</span><span class="p">,</span><span class="n">node_total</span><span class="p">,</span> <span class="s">",  ele_total = "</span><span class="p">,</span><span class="n">ele_total</span><span class="p">)</span>
<span class="c">#print("detA = ", scipy.linalg.det(mat_A_glo)) #Aの行列式</span>
<span class="c">#print("Rank A = ", np.linalg.matrix_rank(mat_A_glo)) #AのRank(階数)</span>
<span class="c">#print("Inverse A = ", scipy.linalg.inv(mat_A_glo)) #Aの逆行列</span>

<span class="k">print</span><span class="p">(</span><span class="s">"Unkown vector u = "</span><span class="p">)</span> <span class="c">#未知数ベクトル</span>
<span class="n">unknown_vec_u</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">mat_A_glo</span><span class="p">,</span><span class="n">vec_b_glo</span><span class="p">)</span> <span class="c">#Au=bから、未知数ベクトルuを求める</span>
<span class="k">print</span><span class="p">(</span><span class="n">unknown_vec_u</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Max u = "</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">unknown_vec_u</span><span class="p">),</span> <span class="s">",  Min u = "</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">unknown_vec_u</span><span class="p">))</span> <span class="c">#uの最大値、最小値</span>

<span class="c">#計算時間の表示</span>
<span class="n">compute_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span><span class="n">compute_time</span>
<span class="k">print</span> <span class="p">(</span><span class="s">"Compute_time: {:0.5f}[sec]"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">compute_time</span><span class="p">))</span>



<span class="c">############### 計算結果を可視化 ###############</span>
<span class="c">#plt.rcParams['font.family'] = 'Times New Roman' #全体のフォントを設定</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Finite element analysis of 1D Poisson's equation"</span><span class="p">)</span> <span class="c">#グラフタイトル</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"$x$"</span><span class="p">)</span> <span class="c">#x軸の名前</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"$u(x)$"</span><span class="p">)</span> <span class="c">#y軸の名前</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span> <span class="c">#点線の目盛りを表示</span>

<span class="c">#厳密解をプロット</span>
<span class="n">exact_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span><span class="n">x_max</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">exact_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">func_f</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">exact_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="p">(</span><span class="o">-</span><span class="n">func_f</span><span class="o">*</span><span class="n">x_max</span> <span class="o">+</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">exact_x</span> \
          <span class="o">-</span><span class="p">(</span><span class="n">func_f</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">x_min</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="p">(</span><span class="o">-</span><span class="n">func_f</span><span class="o">*</span><span class="n">x_max</span> <span class="o">+</span><span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="n">x_min</span> <span class="o">+</span><span class="n">alpha</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exact_x</span><span class="p">,</span><span class="n">exact_y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"$u(x)$"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#ff0000'</span><span class="p">)</span> <span class="c">#折線グラフを作成</span>

<span class="c">#近似解をプロット</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">node_x_glo</span><span class="p">,</span><span class="n">unknown_vec_u</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"$</span><span class="err">\</span><span class="s">hat{u}(x)$"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#0000ff'</span><span class="p">)</span> <span class="c">#折線グラフを作成</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">node_x_glo</span><span class="p">,</span><span class="n">unknown_vec_u</span><span class="p">)</span> <span class="c">#点グラフを作成</span>

<span class="c">#更に体裁を整える</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">"tight"</span><span class="p">)</span> <span class="c">#余白を狭くする</span>
<span class="c">#plt.axis("image") #座標のアスペクト比を維持して余白を狭くする</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#000000'</span><span class="p">)</span> <span class="c">#x軸(y=0)の線</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#000000'</span><span class="p">)</span> <span class="c">#y軸(x=0)の線</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">'best'</span><span class="p">)</span> <span class="c">#凡例(グラフラベル)を表示</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node_total</span><span class="p">):</span> <span class="c">#節点番号をグラフ内に表示</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">node_x_glo</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="n">unknown_vec_u</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s">'bottom'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'#0000ff'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c">#グラフを表示</span>
<span class="c">#plt.savefig("fem1d_poisson.png")</span>
</pre></div>
</div>

<h2>
<span id="資料とか" class="fragment"></span><a href="#%E8%B3%87%E6%96%99%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>資料とか</h2>

<p><a href="http://www.multi.k.u-tokyo.ac.jp/lectures/pukiwiki/index.php?plugin=attach&amp;pcmd=open&amp;file=1%E6%AC%A1%E5%85%83%E5%95%8F%E9%A1%8C%E3%81%AE%E6%9C%89%E9%99%90%E8%A6%81%E7%B4%A0%E6%B3%95.pdf&amp;refer=HPC%E8%B3%87%E6%96%99&amp;age=1" rel="nofollow noopener" target="_blank">奥田洋司, 1次元問題の有限要素法, 東京大学大学院, (2006).</a><br>
菊地文雄, 有限要素法概説 理工学における基礎と応用, コロナ社, (1999).<br>
J. L. Volakis, A. Chatterjee, and L. C. Kempel, Finite Element Method for Electromagnetics, Wiley-IEEE Press, (1998).<br>
日本建築学会編, はじめての音響数値シミュレーション プログラミングガイド, コロナ社, (2012).</p>
</div></section><div class="it-Footer"><div class="it-Footer_actions"><div class="it-Footer_editRequest"><a class="u-link-no-underline" href="/Sunset_Yuhi/items/4c4ddc25609a7619cce0/edit"><span class="fa fa-fw fa-send"></span><span>編集リクエスト</span></a></div><div class="it-Footer_stock"><button><span class="fa fa-folder-open"></span><span class="it-Footer_stockLabel">ストック</span></button></div><div class="it-Footer_like"><button><span class="fa fa-fw fa-thumbs-up"></span><span>いいね</span></button><a class="it-Footer_likeCount" href="/Sunset_Yuhi/items/4c4ddc25609a7619cce0/likers">17</a></div></div><div class="it-Footer_social"><div class="it-Footer_shareButton it-Footer_shareButton-webshare"><span class="fa fa-share-alt"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-twitter"><span class="fa fa-twitter"></span></div><div class="it-Footer_shareButton it-Footer_shareButton-facebook"><span class="fa fa-facebook"></span></div></div></div><div class="ai-Container" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><div class="it-User"><a href="/Sunset_Yuhi"><img class="ai-User_image" itemprop="image" alt="Sunset_Yuhi" src="https://qiita-image-store.s3.amazonaws.com/0/114084/profile-images/1473712473" /></a><div class="ai-User_body"><div class="ai-User_header"><a class="ai-User_urlname" itemprop="name" href="/Sunset_Yuhi">Sunset_Yuhi</a></div><div class="ai-User_description"></div></div></div></div></div></div><div class="p-items_options"></div><div class="p-items_toc"><div class="it-Toc"><div class="it-Toc_nav"><ul>
<li>
<a href="#%E8%A7%A3%E3%81%8D%E3%81%9F%E3%81%84%E5%95%8F%E9%A1%8C">解きたい問題</a>
</li>
<li>
<a href="#%E5%8E%B3%E5%AF%86%E8%A7%A3%E3%82%92%E6%B1%82%E3%82%81%E3%82%8B">厳密解を求める</a>
</li>
<li>
<a href="#%E8%BF%91%E4%BC%BC%E8%A7%A3%E3%81%AE%E6%B1%82%E3%82%81%E6%96%B9%E3%82%92%E8%80%83%E3%81%88%E3%82%8B">近似解の求め方を考える</a>
</li>
<li>
<a href="#%E6%94%AF%E9%85%8D%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E5%BC%B1%E5%BD%A2%E5%BC%8F%E5%8C%96">支配方程式の弱形式化</a>
</li>
<li>
<a href="#%E5%BC%B1%E5%BD%A2%E5%BC%8F%E3%81%AE%E9%9B%A2%E6%95%A3%E5%8C%96">弱形式の離散化</a>
</li>
<li>
<a href="#%E7%B7%9A%E5%BD%A2%E9%80%A3%E7%AB%8B%E6%96%B9%E7%A8%8B%E5%BC%8F%E3%81%AE%E6%A7%8B%E7%AF%89">線形連立方程式の構築</a>
</li>
<li>
<a href="#%E5%A2%83%E7%95%8C%E6%9D%A1%E4%BB%B6%E5%87%A6%E7%90%86">境界条件処理</a>
</li>
<li>
<a href="#%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0">プログラム</a>
</li>
<li>
<a href="#%E8%B3%87%E6%96%99%E3%81%A8%E3%81%8B">資料とか</a>
</li>
</ul>
</div></div></div></div></div><div class="p-items_wrapper p-items_wrapper-white"><div class="p-items_container"><div class="p-items_leftDummy"></div><div class="p-items_main"></div><div class="p-items_rightDummy"></div></div></div></article></div><footer id="globalFooter" class="st-Footer px-2 px-1@s pt-1 pt-3@s pb-2"><div class="st-Footer_container"><ul class="st-Footer_start"><li class="st-Footer_link"><a class="st-Footer_copyright" href="https://increments.co.jp">© 2011-2018 Increments Inc.</a></li><li class="st-Footer_link"><a href="/terms">利用規約</a></li><li class="st-Footer_link"><a href="/privacy">プライバシー</a></li><li class="st-Footer_link"><a href="https://help.qiita.com">ヘルプ</a></li><li class="st-Footer_link"><a href="https://increments.zendesk.com/hc/ja/requests/new">お問い合わせ</a></li></ul><ul class="st-Footer_end"><li class="st-Footer_link"><a href="/about">Qiita とは</a></li><li class="st-Footer_link"><a href="/users">ユーザー</a></li><li class="st-Footer_link"><a href="/tags">タグ</a></li><li class="st-Footer_link"><a href="/items">投稿</a></li><li class="st-Footer_link"><a href="http://blog.qiita.com">ブログ</a></li><li class="st-Footer_link"><a href="/api/v2/docs">API</a></li><li class="st-Footer_link"><a href="https://teams.qiita.com">Qiita:Team</a></li></ul></div></footer></div><div class="p-messages"><div data-hyperapp-app="Message" data-hyperapp-props="{&quot;messages&quot;:[]}"></div></div><div id="dataContainer" style="display: none;" data-config="{&quot;actionPath&quot;:&quot;public/items#show&quot;,&quot;settings&quot;:{&quot;analyticsTrackingId&quot;:&quot;UA-24675221-12&quot;,&quot;mixpanelToken&quot;:&quot;17d24b448ca579c365d2d1057f3a1791&quot;,&quot;assetsMap&quot;:{},&quot;csrfToken&quot;:&quot;nPCP/QwXuy1+28SLwQX/BTxdEOsZZKoleKG9TOksybh0JgQFDEUF48CTkPbkIYejWMhirs6GV5aamNils8zS4Q==&quot;,&quot;locale&quot;:&quot;ja&quot;},&quot;currentUser&quot;:null}" /><script>/* <![CDATA[ */
var yahoo_retargeting_id = '6B63B2EQA6';
var yahoo_retargeting_label = 'qiita';
var yahoo_retargeting_page_type = '';
var yahoo_retargeting_items = [{item_id: '', category_id: '', price: '', quantity: ''}];
/* ]]> */</script><script language="javascript" src="https://b92.yahoo.co.jp/js/s_retargeting.js" type="text/javascript"></script><script src="//platform.twitter.com/oct.js" type="text/javascript"></script><script>twttr.conversion.trackPid('nzz0o', { tw_sale_amount: 0, tw_order_quantity: 0 });</script><noscript><img alt="" height="1" src="https://analytics.twitter.com/i/adsct?txn_id=nzz0o&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0" style="display:none;" width="1" /><img alt="" height="1" src="//t.co/i/adsct?txn_id=nzz0o&amp;p_id=Twitter&amp;tw_sale_amount=0&amp;tw_order_quantity=0" style="display:none;" width="1" /></noscript></body></html>